(()=>{var E=e=>e!==null&&typeof e=="object"&&!Array.isArray(e),h=e=>typeof e=="function",z=e=>Array.isArray(e),T=e=>typeof e=="string",Ie=e=>typeof e=="number";var O=e=>e===void 0;function w(e,t={},...r){Le("Warning",e,t,...r)}function f(e,t={}){let r=typeof e=="string"?e:e.message||"Unknown error",o={message:r,...t};setTimeout(()=>Le("Error",r,o),0)}function fe(e,t={},...r){let{el:o,expression:n,message:i="",defaultValue:s=null,rethrow:a=!1,onError:c}=t;try{return e(...r)}catch(u){let m=`${i}
${u.message}`;if(f(m,{el:o,expression:n}),c&&h(c)&&c(u,{el:o,expression:n,message:i}),a)throw u;return s}}function Le(e,t,r={},...o){let{el:n,expression:i,component:s}=r,a=new Date().toISOString(),c={message:t,el:n,expression:i,component:s,timestamp:a,additionalInfo:o},u=e.toLowerCase()==="error"?"#FF0000":"#FFA500";console.groupCollapsed(`%c[Asor ${e}]: ${t}`,`color: ${u}; font-weight: bold;`),console.log(c),console.groupCollapsed("Stack Trace"),console.trace(),console.groupEnd()}var q=new Map,x=(e,t,r,o={})=>{let n=q.get(t);n||(n=new Set,q.set(t,n)),n.add(r);let i=new AbortController;return e.addEventListener(t,r,{...o,signal:i.signal}),()=>{i.abort(),n.delete(r),n.size===0&&q.delete(t)}},d=(e,t,r,o={})=>{let n=new CustomEvent(t,{bubbles:!0,cancelable:!0,...o,detail:r});return n.__asor={name:t,detail:r,receivedBy:[]},e.dispatchEvent(n)},Fe=(e,t)=>x(window,e,r=>r.__asor&&t(r)),Pe=(e,t)=>d(window,e,t),qe=(e,t,r)=>d(e,t,r,{bubbles:!1}),He=()=>{q.forEach(e=>e.clear()),q.clear()};var $=new WeakMap,ue=new Set,K=!1;function b(e,t){return $.has(e)||$.set(e,[]),$.get(e).push(t),()=>{let r=$.get(e);if(r){let o=r.indexOf(t);o>-1&&r.splice(o,1),r.length===0&&$.delete(e)}}}function I(e){ue.add(e),Et()}function Et(){K||(K=!0,queueMicrotask(()=>Dt()),K=!1)}function Dt(){ue.forEach(e=>{D(e);let t=$.get(e);t&&t.forEach(r=>r())}),ue.clear(),K=!1}var Re=new WeakMap;function _(e,t){Re.set(e,t),e.__asor_def=t}function g(e){for(;e;){if(e.__asor_def)return e.__asor_def;e=e.parentElement}return{}}var B=e=>{Re.delete(e),delete e.__asor_def};function D(e,t){let r=g(e);r&&(Object.assign(r,t),I(e))}var L=(e,t)=>{for(;e&&e!==document.body;){if(t(e))return e;e=e.parentElement}return null},Ue=e=>document.querySelector(`meta[name='${e}']`)?.getAttribute("content")||"";var Ve=e=>L(e,t=>t.hasAttribute("a-def"))||document.body,X=e=>L(e,t=>t.dataset&&Object.keys(t.dataset).length>0||t.hasAttribute("a-def"))||document.body;var le=e=>e.tagName==="FORM";var ke=(e,t)=>window.getComputedStyle(e).getPropertyValue(t);var H=(e="asor-",t=8)=>`${e}${Date.now()}-${Math.random().toString(36).slice(2,2+t)}`;function A(e=document.body,t=["a-","@",":"]){let r=[],o=document.createNodeIterator(e,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>Array.from(i.attributes).some(s=>t.some(a=>s.name.startsWith(a)))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}),n;for(;n=o.nextNode();)r.push(n);return r}var je=new WeakMap,ze=new Map,de=new Map;function _t(e){let t=e.join("|");return de.has(t)||de.set(t,new RegExp(`^(?:${t})([^\\s.:]+)(?:\\.[^\\s.:]+)*(?::[^\\s]+)?\\s*`)),de.get(t)}var St=e=>{if(!e)throw new Error("Directive name is required");return e.startsWith(":")?`a-bind:${e.slice(1)}`:e.startsWith("@")?`a-on:${e.slice(1)}`:e.startsWith("a-")?e:`a-${e}`},l=(e,t)=>ze.set(e,t),J=(e=document.body)=>A(e).forEach(Y);function Y(e){if(!e)return f(`Undefined element: ${e}`);let t=F(e);t.directives.sort((r,o)=>We.get(r.name)-We.get(o.name)).forEach(r=>{let o=ze.get(r.name);o&&o({el:e,directive:r,manager:t})})}var Ke=e=>Array.from(e.attributes).some(t=>t.name.startsWith(":")||t.name.startsWith("@")||t.name.startsWith("a-")),F=e=>{let t=je.get(e);if(!t){let r=Tt(e);t={el:e,directives:r,hasDirective:o=>r.some(n=>n.name===o),getDirective:o=>r.find(n=>n.name===o),delDirective:o=>t.directives=t.directives.filter(n=>n.name!==o)},je.set(e,t)}return t},Ct=["ref","def","id","bind","init","confirm","xhr","on","effect","show","navigate","transition","for","if","loading","offline","stream"],We=new Map(Ct.map((e,t)=>[e,t])),p=(e,t)=>{let r=F(e).getDirective(t);return r?{...r,name:t}:null},Tt=e=>{if(!e?.attributes)return f("Invalid element in extractDirectives"),[];let t=_t(["a-","@",":"]);return Array.from(e.attributes).filter(r=>t.test(r.name)).map(({name:r,value:o})=>At(e,r,o))},At=(e,t,r)=>{let o=St(t),{directiveName:n,directiveValue:i}=Mt(o),s=Nt(t);return{el:e,name:n,fullName:o,expression:r,value:i,modifiers:s,hasModifier:a=>s.has(a),getModifierValue:a=>s.get(a),getAllModifiers:()=>Array.from(s,([a,c])=>({name:a,value:c})),hasModifiers:()=>s.size>0,firstModifier:()=>{let[a,c]=s.entries().next().value||[];return a?{name:a,value:c}:null}}},Mt=e=>{let t=/^a-(?:(on):)?([^:.]+)(?::([^.]+))?/,[,r,o,n]=e.match(t)||[];return{directiveName:r||o,directiveValue:r?o:n}},Nt=e=>{let t=e.match(/\.[^.\]]+(?=[^\]]*$)/g)||[];return new Map(t.map(r=>{let[o,n]=r.slice(1).split("-");return[o,n===void 0?!0:n]}))};async function Be(e,t){let r=A(e),o=A(t);r.forEach(n=>{let i=o.find(s=>s.isEqualNode(n));if(!i||!Ot(n,i))Y(n);else{let s=g(i);s&&_(n,s)}})}function Ot(e,t){let r=F(e),o=F(t);return r.directives.length!==o.directives.length?!1:r.directives.every((n,i)=>{let s=o.directives[i];return n.name===s.name&&n.expression===s.expression})}var M={};function $t(e={}){return M=new Proxy(e,{get(t,r){return typeof t[r]=="object"&&t[r]!==null?new Proxy(t[r],this):t[r]},set(t,r,o){return t[r]=o,Xe(),!0}}),M}function Xe(){document.querySelectorAll("[a-def]").forEach(e=>{try{e&&e.__asor_def&&(e.__asor_def.$store={...M},D(e))}catch(t){f("Error updating element after store change:",t,e)}})}var R=()=>M;function It(e,t){typeof t=="object"&&t!==null?M[e]={...M[e],...t}:M[e]=t,Xe()}var Je=(e,t)=>t===void 0?R()[e]:It(e,t);$t();var pe={parseInt,parseFloat,isNaN,isFinite,encodeURIComponent,decodeURIComponent,encodeURI,decodeURI};function G(e,t={}){let r=Ve(e),o=g(e)||g(r)||{},n=r._asor_refs||{},i={$el:e,$event:t.$event||{},$refs:n,$root:{...r,dataset:r?{...r.dataset}:{}},$dispatch:(s,a)=>d(e,s,a),$persist:s=>({__isPersist:!0,initialValue:s}),$store:R(),$id:s=>{let a=e._asor_ids||(e._asor_ids={});return a[s]||(a[s]=H(s))}};return{...i,$data:new Proxy(o,{get(s,a){if(a in s)return s[a];if(a in i)return i[a];if(a in t)return t[a];if(a in pe)return pe[a]}}),...pe,...t}}var Q=new Map;function Ye(e,t){if(typeof t!="function"){f(`Component "${e}" must be a function.`);return}Q.set(e,t)}function Lt(e){return Q.get(e)}function Ge(e){return Q.has(e)}function Qe(){return Q.get()}var Ze=(e,t)=>{let r=Lt(e);try{let o=G(t,{});return r(o)}catch(o){return f(`Error executing component: ${o.message}`,{el:t,expression:e}),null}};var Z=!1;function et(e=!1){if(Z&&!e){w("Asor is already initialized. Skipping re-initialization.");return}me();let t=()=>{d(document,"asor:init"),d(document,"asor:initializing"),requestAnimationFrame(()=>{J(),Z=!0,d(document,"asor:initialized")})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t()}function me(e=null){if(!Z)return;let t=Qe();t.forEach((r,o)=>{r&&h(r.destroy)&&safeCall(()=>r.destroy(),{el:o,expression:"destroy()",message:"Error executing destroy() for component."})}),t.clear(),He(),window.asor&&delete window.asor,e&&h(e)&&e(),d(document,"asor:stopped"),Z=!1}var U=new Map,Ft=500,Pt=(e,t)=>({el:e,expression:t,rethrow:!1,defaultValue:null,message:`Error evaluating expression: "${t}"`}),qt=e=>`
    with (__context) {
        with ($data) {
            return (${e});
        }
    }
`,Ht=e=>`
    try {
        ${e}
    } catch (e) {
        if (e instanceof ReferenceError) return undefined;
        throw e;
    }
`,Rt=e=>{let t=qt(e),r=Ht(t);return new Function("__context",r)},Ut=(e,t)=>{let r=Object.keys(t).sort().join(",");return`${e}::${r}`},Vt=(e,t)=>{if(U.size>=Ft){let r=U.keys().next().value;U.delete(r)}U.set(e,t)};function he(e,t,r){let o=Pt(e,t);if(h(t))return fe(t,o,r);if(!T(t))return f(`Invalid expression type: ${typeof t}. Expected string or function.`,e,t),null;let n=G(e,r),i=Ut(t,n),s=U.get(i);return s||(s=Rt(t),Vt(i,s)),fe(()=>s(n),o)}var y=(e,t,r={})=>he(e,t,r);function ee(e,t){let r;return function(...o){clearTimeout(r),r=setTimeout(()=>e(...o),t)}}function te(e,t){let r;return function(...o){r||(e.apply(this,o),r=!0,setTimeout(()=>r=!1,t))}}function rt(e){return p(e,"swap")?.expression||"innerHTML"}var tt={innerHTML:(e,t)=>{e.innerHTML=t},outerHTML:(e,t)=>{e.outerHTML=t},beforebegin:(e,t)=>{e.insertAdjacentHTML("beforebegin",t)},afterbegin:(e,t)=>{e.insertAdjacentHTML("afterbegin",t)},beforeend:(e,t)=>{e.insertAdjacentHTML("beforeend",t)},afterend:(e,t)=>{e.insertAdjacentHTML("afterend",t)},replace:(e,t)=>{e.replaceWith(...ge(t))},append:(e,t)=>{e.append(...ge(t))},prepend:(e,t)=>{e.prepend(...ge(t))}};function re(e,t,r){try{(tt[r]||tt.innerHTML)(e,t)}catch(o){f(`Error applying swap method "${r}":`,o)}}var ge=e=>{let t=document.createElement("div");return t.innerHTML=e,t.childNodes};var V=new WeakMap;function ot(e){if(V.has(e))return V.get(e);let t=p(e,"target");if(t){let r=t.expression?.trim();if(r){let o=document.querySelector(r);if(o)return V.set(e,o),o;w(`Target element "${r}" not found. Using original element.`)}}return V.set(e,e),e}function nt(e){let t=p(e,"target");t?.modifiers.includes("once")&&(e.removeAttribute(t.directive),V.delete(e))}var ye=new Set,xe=!1;async function oe(e,t){let o=new DOMParser().parseFromString(t,"text/html"),n=ot(e),i=rt(n),s=o.body.innerHTML,a=n.cloneNode(!0);Wt(n,()=>{re(n,s,i),kt(a,n),jt(n),nt(n)})}function kt(e,t){let r=A(e),o=A(t);o.forEach(n=>{let i=r.find(s=>s.isEqualNode(n));if(i){let s=g(i);s&&_(n,s)}}),Be(t,e),r.forEach(n=>{o.some(i=>i.isEqualNode(n))||it(n)})}function it(e){let t=g(e);t&&t.$refs&&Object.keys(t.$refs).forEach(r=>{t.$refs[r]===e&&delete t.$refs[r]}),B(e),Array.from(e.children).forEach(it)}function jt(e){p(e,"transition")&&d(e,"asor:transition",{visible:!0})}function Wt(e,t){ye.add({el:e,updateFn:t}),zt()}function zt(){xe||(xe=!0,requestAnimationFrame(Kt))}function Kt(){for(let{el:e,updateFn:t}of ye)t(e);ye.clear(),xe=!1}l("ref",({el:e,directive:t})=>{let r=t.expression;if(!r)return;let o=X(e);if(o._asor_refs||(o._asor_refs={}),o._asor_refs[r]=e,o!==document.documentElement){let n=g(o)||{};n.$refs=o._asor_refs,_(o,n)}return()=>Bt(rootData)});function Bt(e){let t=getDirectiveValue(e,"ref")?.expression;if(t&&(delete e._asor_refs[t],e!==document.documentElement)){let r=g(e)||{};r.$refs&&(delete r.$refs[t],_(e,r))}}var st="asor_persist_";function at(e,t){let r=e.uniqueId||st+e,o=localStorage.getItem(r);if(o===null)return t;try{return JSON.parse(o)}catch(n){return w(`Error parsing stored value for key ${e}:`,n),t}}function ve(e,t){let r=e.uniqueId||st+e;try{localStorage.setItem(r,JSON.stringify(t))}catch(o){f(`Error storing value for key ${e}:`,o)}}var we=new WeakMap;function be(e,t){if((!e||!E(e))&&(e={}),we.has(e))return we.get(e);let r=Gt(e,t),o=new Proxy(r,Xt(t));return we.set(e,o),o}function Xt(e){return{get(t,r,o){let n=Reflect.get(t,r,o);return n&&n.__isPersist?n.value:h(n)&&!r.startsWith("__")?Jt(n,e,o):n},set(t,r,o,n){if(Yt(t,r,o,e))return!0;let i=t[r];return Reflect.set(t,r,o,n),i!==o&&I(e),!0}}}function Jt(e,t,r){return function(...o){let n=e.apply(r,o);return I(t),n}}function Yt(e,t,r,o){if(e[t]&&e[t].__isPersist){let n=e[t].value;return e[t].value=r,ve(t,r),n!==r&&I(o),!0}return!1}function Gt(e,t){let r={};return Qt(e,r),Zt(e,r,t),r}function Qt(e,t){Object.keys(e).forEach(r=>{let o=Object.getOwnPropertyDescriptor(e,r);o&&typeof o.get=="function"&&Object.defineProperty(t,r,{get:o.get.bind(t),enumerable:!0,configurable:!0})})}function Zt(e,t,r){Object.entries(e).forEach(([o,n])=>{n&&n.__isPersist?t[o]=er(o,n):E(n)?t[o]=be(n,r):h(n)?t[o]=n:t[o]||(t[o]=n)})}function er(e,t){let r=at(e,t.initialValue);return r==null&&(r=t.initialValue),ve(e,r),{__isPersist:!0,value:r}}var ct=(e,t)=>{if(E(e))return e;if(!T(e)||!e.trim())return{};try{let r=he(t,`(${e})`,{});if(E(r))return r;f(`Invalid data attribute: ${e}`,t,e)}catch(r){return f(`Error parsing data attribute: ${r.message}`,t,e),{}}};function ft(e){let t=e.match(/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/);if(!t)return null;let[,r,o]=t,n=r.replace(/^\(|\)$/g,"").split(",").map(i=>i.trim());return n.length===1?{item:n[0],items:o.trim()}:n.length===2?{item:n[0],key:n[1],items:o.trim()}:n.length===3?{item:n[0],key:n[1],index:n[2],items:o.trim()}:null}l("def",({el:e,directive:t})=>{try{let r=t.expression;r=r===""?"{}":r;let o=Ge(r)?Ze(r,e):ct(r,e);if(!o){f(`Failed to obtain data for a-def directive with expression: ${r}`,{el:e});return}let n=be(o,e);n.$store=R(),_(e,n),D(e);let i=b(e,()=>D(e));return()=>{i(),B(e),e.removeAttribute("a-def")}}catch(r){f("Error in a-def directive:",r,e)}});var tr={text:e=>e.textContent,html:e=>e.innerHTML,value:e=>e.value,checked:e=>e.checked,selected:e=>e.selected,class:e=>e.className},rr=new Map([["text",(e,t)=>e.textContent=t??""],["html",(e,t)=>e.innerHTML=t??""],["value",(e,t)=>{e.value!==t&&(e.value=t??"")}],["checked",(e,t)=>e.checked=!!t],["disabled",(e,t)=>e.disabled=!!t],["readonly",(e,t)=>e.readOnly=!!t],["required",(e,t)=>e.required=!!t],["multiple",(e,t)=>e.multiple=!!t],["hidden",(e,t)=>e.hidden=!!t],["radio",(e,t)=>e.checked=e.value==t],["open",(e,t)=>e.open=!!t],["class",ir],["style",sr],["selected",fr],["multipleSelect",ur],["contenteditable",(e,t)=>{e.innerHTML!==t&&(e.innerHTML=t)}],["number",(e,t)=>{e.value=t==null?"":Number(t)}]]);function ut(e,t,r){if(!e)return;let o=or(e,t);Object.is(o,r)||nr(e,t,r)}function or(e,t){return tr[t]?.(e)??e.getAttribute(t)}function nr(e,t,r){(rr.get(t)||((o,n)=>o.setAttribute(t,n??"")))(e,r)}function ir(e,t){if(T(t))e.className=t;else if(z(t))e.className=t.join(" ");else if(E(t))for(let[r,o]of Object.entries(t))r.includes(" ")?r.split(" ").forEach(n=>{e.classList.toggle(n.trim(),!!o)}):e.classList.toggle(r,!!o)}function sr(e,t){T(t)?e.style.cssText=t:E(t)&&Object.assign(e.style,t)}function ar(e,t,r){let o=cr(e,r),n=e.closest("[a-def]");if(!n)return;g(n)&&D(n,{[t]:o})}function cr(e,t){return e.tagName==="SELECT"&&e.multiple?Array.from(e.selectedOptions).map(r=>r.value):e.type==="date"||e.type==="datetime-local"?e.valueAsDate:e.type==="checkbox"?t.target.checked:e.type==="file"?e.multiple?Array.from(e.files):e.files[0]:t.target.value}function fr(e,t){let r=Array.from(e.options);if(z(t))r.forEach(o=>o.selected=t.includes(o.value));else{let o=r.find(n=>n.value==t);o&&(o.selected=!0,e.value=o.value)}}function ur(e,t){z(t)||(t=[t]),Array.from(e.options).forEach(r=>r.selected=t.includes(r.value))}function lt(e,t){if(["INPUT","TEXTAREA","SELECT"].includes(e.tagName)){let r=e.type==="checkbox"||e.type==="radio"||e.type==="file"?"change":"input";return x(e,r,o=>ar(e,t,o))}return null}l("bind",({el:e,directive:t})=>{let r=t.value||"text",o=t.expression;if(!o){f("La expresi\xF3n de binding est\xE1 vac\xEDa",null,e);return}let n=L(e,c=>c.__asor_def);if(!n){f("No se encontr\xF3 un propietario de datos para la directiva a-bind",e);return}let i=null,s=async()=>{try{let c=g(n),u=await y(e,o,{data:c});if(O(u))return;ut(e,r,u),i&&i(),i=lt(e,o)}catch(c){f("Error al actualizar el binding:",c,e)}};s();let a=b(n,()=>s());return()=>{a(),i&&i()}});l("init",({el:e,directive:t})=>{let r=t.expression?.trim();if(!r)return;let o=e.__asor_def||g(e);if(!o){f("No data found for a-init directive:",e);return}(async()=>await y(e,r,{data:o,$el:e}))()});l("effect",({el:e,directive:t})=>{let r=t.expression,o=async()=>{let s=e.__asor_def||g(e);if(!s)return;let a=await y(e,r,{data:s});if(h(a))return await a()},n,i=async()=>{n&&(n(),n=null);let s=await o();h(s)&&(n=s)};return i(),b(e,i)});l("confirm",({el:e,directive:t})=>{let r=t.expression,o=t.hasModifier("prompt");r=r.replaceAll("\\n",`
`),r===""&&(r="Are you sure?");let n=(i,s,a)=>{i?s():a()};e.__confirm_action=(i,s)=>{if(o){let[a,c]=r.split("|");c||f("Directives: You must provide an expectation with @confirm.prompt.");let u=prompt(a);n(u===c,i,s)}else n(confirm(r),i,s)}});function pt(e){let t=document.getElementById("asor-error");t||(t=document.createElement("div"),t.id="asor-error",t.style.cssText=`
            position: fixed;
            width: 100vw;
            height: 100vh;
            padding: 50px;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 200000;
        `,t.addEventListener("click",()=>dt(t)),t.tabIndex=0,document.body.prepend(t),document.body.style.overflow="hidden");let r=document.createElement("iframe");r.style.cssText=`
        background-color: #17161A;
        border-radius: 5px;
        width: 100%;
        height: 100%;
    `,t.innerHTML="",t.appendChild(r),r.contentWindow.document.open(),r.contentWindow.document.write(e),r.contentWindow.document.close(),t.addEventListener("keydown",o=>{o.key==="Escape"&&dt(t)}),t.focus()}function dt(e){e.outerHTML="",document.body.style.overflow="visible"}function De(e){return new Ee(e)}var Ee=class{constructor(t){this.formData=new FormData,this.hasFile=!1,this.errors=[],t.tagName==="FORM"?this.serializeForm(t):this.collectElementData(t),this.addDirectiveData(t)}collectElementData(t){let r=this.elementHandlers[t.tagName];r&&r.call(this,t)}elementHandlers={SELECT:this.handleSelect,TEXTAREA:this.handleTextArea,INPUT:this.handleInput,BUTTON:this.handleButton};handleSelect(t){t.multiple?Array.from(t.selectedOptions).forEach(r=>{this.formData.append(t.name,r.value)}):this.formData.append(t.name,t.value)}handleTextArea(t){this.formData.append(t.name,t.value)}handleInput(t){let r={checkbox:()=>this.formData.append(t.name,t.checked),radio:()=>{t.checked&&this.formData.append(t.name,t.value)},file:()=>{t.files.length>0&&(Array.from(t.files).forEach(o=>{this.formData.append(t.name,o)}),this.hasFile=!0)},date:()=>{let o=new Date(t.value);isNaN(o.getTime())||this.formData.append(t.name,o.toISOString())},number:()=>{let o=parseFloat(t.value);isNaN(o)||this.formData.append(t.name,o)},default:()=>this.formData.append(t.name,t.value)};(r[t.type]||r.default)()}handleButton(t){t.name&&(t.type==="submit"||t.type==="button")&&this.formData.append(t.name,t.value||t.textContent)}addDirectiveData(t){let r=p(t,"data");r&&this.formData.append(r.value,r.expression);let o=p(t,"add");if(o)try{let n=JSON.parse(o.expression);Object.entries(n).forEach(([i,s])=>{this.formData.append(i,s)})}catch(n){f("Error parsing add directive:",n)}}serializeForm(t){this.formData=new FormData(t),this.hasFile=Array.from(this.formData.values()).some(r=>r instanceof File)}toObject(){let t={};for(let[r,o]of this.formData.entries())t[r]?(Array.isArray(t[r])||(t[r]=[t[r]]),t[r].push(o)):t[r]=o;return t}toJSON(){return JSON.stringify(this.toObject())}get(){return this.formData}hasFiles(){return this.hasFile}getErrors(){return this.errors}};var _e=new Map,mt=()=>new Se,Se=class{async handleRequest(t,r,o){let n=this.buildRequestOptions(r,t);d(document,"asor:before-request",{method:r,url:o,options:n});try{let i=await this.fetchData(r,o,n,t);if(!i)return;await this.handleResponse(i,t)}catch(i){this.handlerError(i,t)}finally{d(document,"asor:after-request",{method:r,url:o,options:n})}}buildRequestOptions(t,r){let o={method:t.toUpperCase(),headers:this.buildHeaders(r)};if(["POST","PUT","PATCH"].includes(o.method)){let n=De(r);o.body=this.prepareRequestBody(r,n)}return o}buildHeaders(t){return{Accept:"text/html, application/xhtml+xml","X-Requested-With":"XMLHttpRequest","X-Current-URL":document.location.href,"X-Asor":"true","Content-Type":this.getContentType(t)}}getContentType(t){let r=De(t);return le(t)||r.hasFiles()?void 0:p(t,"enctype")?.expression||"application/json"}prepareRequestBody(t,r){return le(t)||r.hasFiles()?r.get():JSON.stringify(r.toObject())}async fetchData(t,r,o,n){d(document,"asor:before-send",{method:t,url:r,options:o}),d(document,"asor:send",{method:t,url:r,options:o});let i=`${t}:${r}`;if(_e.has(i))return _e.get(i);let s=await fetch(r,o);if(!s.ok)return this.handlerError(`HTTP error! status: ${s.status}`,n),!1;let a=await s.text();return _e.set(i,a),a}async handleResponse(t,r){d(document,"asor:before-render",{response:t});let o=this.getTargetDirective(r);await oe(o,t),d(document,"asor:render",{html:t})}getTargetDirective(t){let r=p(t,"target")?.expression;return r?document.querySelector(r):t}handlerError(t,r){f("XHR request failed:",r,t),pt(t.message)}};async function ne(e){return p(e,"confirm")?.expression?new Promise(r=>{h(e.__confirm_action)?e.__confirm_action(()=>r(!0),()=>r(!1)):r(!0)}):!0}var Te={enter:13,tab:9,delete:46,esc:27,space:32,up:38,down:40,left:37,right:39,shift:16,ctrl:17,alt:18,meta:91},Ae=["shift","ctrl","alt","meta"],lr=["get","post","put","patch","delete"],k=new WeakMap,gt=e=>lr.includes(e.value?.toLowerCase())?e.value.toLowerCase():"get",Ce={form:"submit",select:"change",textarea:"input",button:"click",input:{button:"click",submit:"click",reset:"click",checkbox:"change",radio:"change",file:"change",date:"change",time:"change","datetime-local":"change"},default:"click"};function yt(e){let t=e.tagName.toLowerCase(),r=(e.type||"").toLowerCase();return t==="input"?Ce.input[r]||"input":Ce[t]||(e.isContentEditable?"input":e.getAttribute("tabindex")!==null?"focus":Ce.default)}var ie=(e,t,r={})=>{let{preventDefault:o,stopPropagation:n,once:i,delay:s,throttleTime:a,passive:c,keyModifiers:u,self:m}={preventDefault:!1,stopPropagation:!1,once:!1,delay:0,throttleTime:0,passive:!1,keyModifiers:[],self:!1,...r},v=JSON.stringify({preventDefault:o,stopPropagation:n,once:i,delay:s,throttleTime:a,passive:c,keyModifiers:u,self:m});k.has(e)||k.set(e,new Map);let S=k.get(e);if(!S.has(v)){let P=async C=>{if(C.type==="intersect")return ht(()=>t(C),s,a);m&&C.target!==e||mr(C)&&!hr(C,u)||(o&&!c&&h(C.preventDefault)&&C.preventDefault(),n&&h(C.stopPropagation)&&C.stopPropagation(),ht(()=>pr(e,C,t),s,a),i&&dr(e,v))};S.set(v,P)}return S.get(v)},ht=(e,t,r)=>t>0?ee(e,t)():r>0?te(e,r)():e(),dr=(e,t)=>{let r=k.get(e);r.delete(t),r.size===0&&k.delete(e)},pr=async(e,t,r)=>{try{if(!await ne(e))return;(h(r)?await r.call(e,t):!0)!==!1&&e.__xhr_handler&&!e.__xhr_request_in_progress&&await e.__xhr_handler.call(e,t)}catch(o){f("Error in event handler:",o,e)}},mr=e=>e.type?.startsWith("key"),hr=(e,t)=>t.every(r=>Ae.includes(r)?e[`${r}Key`]:e.keyCode===Te[r]),gr=(e,t,r={})=>{let o=new IntersectionObserver(n=>{n.forEach(i=>{if(i.isIntersecting)try{t(i,e),r.once&&o.unobserve(e),r.disconnect&&o.disconnect()}catch(s){f("Error in IntersectionObserver callback:",s)}})},r);return o.observe(e),()=>o.disconnect()},xt=(e,t,r,o={})=>x(document,t,n=>{e.contains(n.target)||r(n)},o);var se=(e,t,r)=>{let{rootMargin:o="0px",threshold:n=.1,once:i}=r;return gr(e,(a,c)=>{let u={type:"intersect",detail:{entry:a,element:c},target:c};d(c,"intersect",u.detail)&&t.call(c,u)},{rootMargin:o,threshold:n,once:i,disconnect:i})};l("xhr",({el:e,directive:t,manager:r})=>{let o=t.expression,n=gt(t),i=yt(e),s=async()=>{if(!e.__xhr_request_in_progress){e.__xhr_request_in_progress=!0;try{await mt().handleRequest(e,n,o)}catch(c){f("XHR request failed:",c)}finally{e.__xhr_request_in_progress=!1}}},a=()=>{};if(r.hasDirective("on"))e.__xhr_handler=s;else{let c=ie(e,s,{preventDefault:!0,stopPropagation:!0});a=x(e,i,c)}return()=>{a(),delete e.__xhr_handler,delete e.__xhr_request_in_progress}});function vt(e,t){if(!(e instanceof Map))return t;for(let[,r]of e){let o=E(r)?r.value:r;if(T(o)){let n=ae(o);if(n!==null)return n}}return t}function ae(e){let t=/^(\d+)(ms|s)$/;if(T(e)&&t.test(e)){let[,r,o]=e.match(t);return o==="ms"?Number(r):Number(r)*1e3}return null}l("on",({el:e,directive:t})=>{let{modifiers:r,expression:o,value:n}=t,i=n?n.split(",").map(a=>a.trim()):[];if(i.length===0){f("No event specified for a-on directive in element: ",e);return}let s={preventDefault:r?.has("prevent")||!1,stopPropagation:r?.has("stop")||!1,once:r?.has("once")||!1,capture:r?.has("capture")||!1,passive:r?.has("passive")||!1,self:r?.has("self")||!1,window:r?.has("window")||!1,document:r?.has("document")||!1,outside:r?.has("outside")||!1,rootMargin:r?.get("rootMargin")?.value,threshold:r?.get("threshold")?.value,delay:ae(r?.get("debounce")?.value||"0"),throttle:ae(r?.get("throttle")?.value||"0"),keyModifiers:Array.from(r?.keys()||[]).filter(a=>a in Te||Ae.includes(a))};try{let c=ie(e,async m=>await y(e,o,{$event:m,$el:e}),s),u=i.map(m=>m==="intersect"?se(e,c,s):yr(e,m,c,s));return()=>u.forEach(m=>m())}catch(a){f(`Error evaluating expression in a-on directive: ${a.message}`,e)}});function yr(e,t,r,o){return o.window?x(window,t,r,o):o.document?x(document,t,r,o):o.outside&&t==="click"?xt(e,t,r,o):x(e,t,r,o)}async function xr(e,t,r,o,n,i,s){let a=document.createElement("template");a.innerHTML=e.trim();let c=a.content.firstElementChild||a.content.firstChild;if(!c)return f("Invalid template in a-for directive",s),null;let u={...n,[i.item]:t,[i.key||"key"]:r,[i.index||"index"]:r,length:o,parent:n};_(c,u),D(c);let m=p(c,"if");if(m&&!await y(c,m.expression,u))return null;let v=p(c,"show");return v&&(c.style.display=await y(c,v.expression,u)?"":"none"),A(c).forEach(S=>{Ke(S)&&Y(S)}),c}async function wt(e,t,r,o,n){if(t==null){w("Items is null or undefined in appendItems");return}let i=Array.isArray(t),s=i?t:Object.entries(t),a=document.createDocumentFragment();e.parentElement.querySelectorAll('[data-asor-generated="true"]').forEach(u=>u.remove());for(let[u,m]of s.entries()){let v=i?u:m[0],S=i?m:m[1],P=await xr(o,S,v,s.length,r,n,e);P&&(P.setAttribute("data-asor-generated","true"),a.appendChild(P))}e.parentElement.insertBefore(a,e.nextSibling)}l("for",({el:e,directive:t})=>{let r=ft(t.expression);if(!r){f("Invalid expression for a-for directive",e);return}let o=e.innerHTML;e.innerHTML="";let n=L(e,c=>c.__asor_def);if(!n){f("No data owner found for a-for directive",e);return}let i=!1,s=async()=>{let c=n.__asor_def,u=await y(e,r.items,c);if(Ie(u)&&(u=vr(u)),O(u)){w(`${r.items} is not defined`,e);return}await wt(e,u,c,o,r),i=!0};s();let a=b(n,()=>{i&&s()});return()=>a()});var vr=e=>{let t=e;return Array.from({length:t},(r,o)=>o+1)};l("if",({el:e,directive:t})=>{let{expression:r}=t,o=document.createComment(`if: ${r}`),n=!1,i=()=>{let s=y(e,r);s&&!n&&e.parentNode?(e.parentNode.insertBefore(o,e.nextSibling),n=!0):!s&&n&&e.parentNode&&(e.parentNode.replaceChild(o,e),n=!1)};return e.parentNode&&e.parentNode.insertBefore(o,e.nextSibling),()=>{i(),o.parentNode&&o.remove(),n&&e.parentNode&&e.remove()}});l("show",({el:e,directive:t})=>{let{expression:r,modifiers:o}=t,n=X(e);if(!n){console.error("No se encontr\xF3 un elemento ra\xEDz con a-def para la directiva a-show.");return}let i=async()=>{try{let a=await y(e,r);O(a)||wr(e,a,o.has("important"))}catch(a){console.error("Error updating visibility for element:",e,a)}};i();let s=b(n,()=>i());return()=>s()});function wr(e,t,r){p(e,"transition")?d(e,"asor:transition",{visible:t}):(e.style.display=t?"":"none",r&&e.style.setProperty("display",e.style.display,"important"))}var j=class e{static DEFAULT_OPTIONS={color:"#29d",height:"3px",duration:300,delay:300,zIndex:14062024,className:"asor-progress-bar"};constructor(t={}){this.options={...e.DEFAULT_OPTIONS,...t},this.bar=null,this.visible=!1,this.timeout=null,this.value=0,this.trickleInterval=null}show(){this.visible||(this.visible=!0,this.value=0,clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.createBar(),this.trickle()},this.options.delay))}hide(){this.visible&&(clearTimeout(this.timeout),clearInterval(this.trickleInterval),this.visible=!1,this.setValue(100),this.timeout=setTimeout(()=>{this.removeBar(),this.value=0},this.options.duration))}setValue(t){this.value=Math.min(100,Math.max(0,t)),this.bar&&(this.bar.style.width=`${this.value}%`,this.updateARIA())}trickle(){clearInterval(this.trickleInterval),this.trickleInterval=setInterval(()=>{let t=100-this.value,r=.02*Math.pow(1-Math.sqrt(t),2);this.setValue(this.value+r)},100)}createBar(){this.bar||(this.bar=document.createElement("div"),this.bar.className=this.options.className,this.bar.style.cssText=`
            position: fixed;
            top: 0;
            left: 0;
            width: 0;
            height: ${this.options.height};
            background-color: ${this.options.color};
            z-index: ${this.options.zIndex};
            transition: width ${this.options.duration}ms ease-out;
            box-shadow: 0 0 10px ${this.options.color}, 0 0 5px ${this.options.color};
            pointer-events: none;
        `,this.setAccessibility(),document.body.appendChild(this.bar))}removeBar(){this.bar&&this.bar.parentNode&&(this.bar.parentNode.removeChild(this.bar),this.bar=null)}setAccessibility(){this.bar&&(this.bar.setAttribute("role","progressbar"),this.bar.setAttribute("aria-valuemin","0"),this.bar.setAttribute("aria-valuemax","100"),this.updateARIA())}updateARIA(){this.bar&&(this.bar.setAttribute("aria-valuenow",Math.round(this.value)),this.bar.setAttribute("aria-label",`Progress: ${Math.round(this.value)}%`))}static injectStyles(){let t=document.createElement("style");t.textContent=`
            @keyframes asor-progress-bar-pulse {
                0% { box-shadow: 0 0 10px ${e.DEFAULT_OPTIONS.color}, 0 0 5px ${e.DEFAULT_OPTIONS.color}; }
                50% { box-shadow: 0 0 20px ${e.DEFAULT_OPTIONS.color}, 0 0 10px ${e.DEFAULT_OPTIONS.color}; }
                100% { box-shadow: 0 0 10px ${e.DEFAULT_OPTIONS.color}, 0 0 5px ${e.DEFAULT_OPTIONS.color}; }
            }
            .${e.DEFAULT_OPTIONS.className} {
                animation: asor-progress-bar-pulse 1.5s infinite ease-in-out;
            }
        `;let r=Ue("csp-nonce");r&&(t.nonce=r),document.head.appendChild(t)}};j.injectStyles();var bt=50,ce=class{constructor(){this.progressBar=new j({delay:250}),this.cache=new Map,this.scrollPositions=new Map,this.currentRequest=null,this.executedScripts=new Set,window.addEventListener("popstate",this.handlePopState.bind(this))}handleNavigate=async t=>{if(this.shouldInterceptClick(t))return;t.preventDefault();let r=t.currentTarget.href||t.currentTarget.getAttribute("href");if(!r){f("No URL found for navigation.");return}await this.navigate(r)};shouldInterceptClick=t=>t.which>1||t.altKey||t.ctrlKey||t.metaKey||t.shiftKey;handlePopState=async()=>{let t=window.location.href,r=new URL(t,document.baseURI).href;if(this.cache.has(r)){let o=this.cache.get(r);await this.renderView(o.html)}else await this.navigate(t,{pushState:!1})};async navigate(t,r={pushState:!0}){try{this.clearExecutedScripts(),this.progressBar.show(),this.saveScrollPosition(),d(document,"asor:navigating",{url:t});let o=await this.loadView(t);if(!o)return;let n=new URL(t,document.baseURI);r.pushState?await this.updateState("pushState",n.href):await this.updateState("replaceState",n.href),await this.renderView(o.html),this.restoreScrollPosition(t),this.animateTransition(),d(document,"asor:navigated",{url:n.href})}catch(o){f("Navigation error:",o)}finally{this.progressBar.hide()}}async loadView(t){let r=new URL(t,document.baseURI).href,o=r;if(this.cache.has(o))return this.cache.get(o);this.currentRequest&&this.currentRequest.abort();let n=new AbortController;this.currentRequest=n;try{let i=await fetch(r,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"},signal:n.signal});i.ok||f(`Navigation to ${t} failed with state ${i.status}`);let a={html:await i.text()};return this.cache.set(o,a),this.trimCache(),a}catch(i){throw i.name==="AbortError"?w(`Solicitud a ${t} abortada`):f(`Error while navigating to ${t}:`,i),i}finally{this.currentRequest===n&&(this.currentRequest=null)}}trimCache(){this.cache.size>bt&&Array.from(this.cache.keys()).slice(0,this.cache.size-bt).forEach(r=>this.cache.delete(r))}saveScrollPosition(){let r=new URL(window.location.href).href;this.scrollPositions.set(r,{x:window.scrollX,y:window.scrollY})}restoreScrollPosition(t){let o=new URL(t).href;requestAnimationFrame(()=>{let n=this.scrollPositions.get(o)||{x:0,y:0};window.scrollTo(n.x,n.y)})}animateTransition(){document.body.style.opacity="0",requestAnimationFrame(()=>{document.body.style.transition="opacity 0.3s",document.body.style.opacity="1",setTimeout(()=>{document.body.style.transition=""},300)})}async updateState(t,r){try{history[t]({},document.title,r)}catch(o){o instanceof DOMException&&o.name==="SecurityError"&&f(`You cannot use asor:navigate with a link to a different root domain: ${r}`)}}async renderView(t){let o=new DOMParser().parseFromString(t,"text/html");document.title=o.title,await this.updateHead(o.head),await this.updateBody(o.body),this.executeScripts(document.head),this.executeScripts(document.body),window.Asor&&h(window.Asor.start)&&window.Asor.start(!0)}async updateHead(t){let r=document.head;Array.from(r.children).forEach(o=>{o.hasAttribute("data-persist")||o.remove()}),Array.from(t.children).forEach(o=>{o.hasAttribute("data-persist")||r.appendChild(o.cloneNode(!0))})}async updateBody(t){document.body.innerHTML=t.innerHTML}executeScripts(t){t.querySelectorAll("script").forEach(r=>{let o=document.createElement("script");Array.from(r.attributes).forEach(n=>o.setAttribute(n.name,n.value)),r.src?this.executedScripts.has(r.src)||(o.src=r.src,this.executedScripts.add(r.src)):(o.textContent=r.textContent,this.executedScripts.add(r.textContent)),r.parentNode.replaceChild(o,r)})}clearExecutedScripts(){this.executedScripts.clear()}async preloadView(t){let r=new URL(t,document.baseURI).href,o=r;if(!this.cache.has(o))try{let n=await fetch(r,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"},signal:AbortSignal.timeout(1e4)});n.ok||f(`Precarga de ${t} fall\xF3 con el estado ${n.status}`);let i=await n.text();this.cache.set(o,{html:i}),this.trimCache()}catch(n){f("Error en la precarga:",n)}}};var W;l("navigate",({el:e,directive:t})=>{if(W||(W=new ce),e.hasNavigateListener)return;e.hasNavigateListener=!0;let r=!1;x(e,"click",async n=>{if(!r){r=!0,n.type==="click"&&n.preventDefault();try{await ne(e)&&await W.handleNavigate(n)}catch(i){f("Navigation error:",i)}finally{r=!1}}}),t.hasModifier("lazy")?br(e,t):t.hasModifier("hover")&&Er(e)});function br(e,t){return se(e,()=>{let o=e.getAttribute("href");o&&W.preloadView(o)},{rootMargin:t.getModifierValue("margin")||"90px",once:t.hasModifier("once")})}function Er(e){x(e,"mouseenter",()=>{let r=e.getAttribute("href");r&&W.preloadView(r)})}l("transition",({el:e,directive:t})=>{let r=Sr(t),o=!1,n=null,i=c=>{if(o||c===n)return;o=!0,n=c;let u=c?"enter":"leave",m=c?r.enterDuration:r.leaveDuration;r.useClasses?Dr(e,u,m):_r(e,c,r),setTimeout(()=>{o=!1,c||(e.style.display="none")},m)},a=x(e,"asor:transition",c=>{let u=c.detail.visible;u!==n&&(u&&(e.style.display=""),i(u))});return n=window.getComputedStyle(e).display!=="none",n||(e.style.display="none"),a});function Dr(e,t,r){let o=p(e,`transition:${t}`)?.expression,n=p(e,`transition:${t}-start`)?.expression,i=p(e,`transition:${t}-end`)?.expression;o&&e.classList.add(o),n&&(e.classList.add(n),requestAnimationFrame(()=>{requestAnimationFrame(()=>{e.classList.remove(n),i&&e.classList.add(i)})})),setTimeout(()=>{o&&e.classList.remove(o),i&&e.classList.remove(i)},r)}function _r(e,t,r){e.style.transition="none",e.offsetWidth,e.style.opacity=t?r.initialOpacity:"1",r.scale&&(e.style.transform=`scale(${t?r.initialScale:"1"})`),e.offsetWidth,e.style.transition=`all ${t?r.enterDuration:r.leaveDuration}ms ${r.easing}`,e.style.opacity=t?"1":r.initialOpacity,r.scale&&(e.style.transform=`scale(${t?"1":r.initialScale})`),r.origin!=="center"&&(e.style.transformOrigin=r.origin)}function Sr(e){let t={enterDuration:300,leaveDuration:300,delay:0,easing:"ease",opacity:!0,scale:!1,initialOpacity:"0",initialScale:"0.95",useClasses:!1,origin:"center"},r=new Map([["duration","enterDuration"],["enter","enterDuration"],["leave","leaveDuration"],["delay","delay"]]);return e.modifiers.forEach((o,n)=>{r.has(n)?(t[r.get(n)]=vt(new Map([[n,o]]),t[r.get(n)]),n==="duration"&&(t.leaveDuration=t.enterDuration)):["ease","ease-in","ease-out","ease-in-out","linear"].includes(n)?t.easing=n:n==="opacity"?(t.opacity=!0,t.scale=!1):n==="scale"?(t.scale=!0,t.opacity=o!=="false",o&&o!=="true"&&(t.initialScale=parseFloat(o)/100)):n==="origin"&&(t.origin=o||"center")}),(p(e.el,"transition:enter")||p(e.el,"transition:leave"))&&(t.useClasses=!0),t}function N(e,t,r,o=null){if(r=t.hasModifier("remove")?!r:r,t.hasModifier("class")){let n=t.expression.split(" ").filter(String);r?e.classList.add(...n):e.classList.remove(...n)}else if(t.hasModifier("attr"))r?e.setAttribute(t.expression,!0):e.removeAttribute(t.expression);else{let n=o??ke(e,"display"),i=["inline","block","table","flex","grid","inline-flex"].find(s=>t.hasModifier(s))||"inline-block";i=t.hasModifier("remove")&&!r?n:i,e.style.display=r?i:"none"}}l("loading",({el:e,directive:t})=>{let r={shortest:50,shorter:100,short:150,default:200,long:300,longer:500,longest:1e3},o=t.getAllModifiers().reduce((v,S)=>r[S.name]||v,r.default),n,i=!1,a=(v=>t.hasModifier("delay")&&!t.hasModifier("none")?()=>{n=setTimeout(()=>{v()},o)}:v)(()=>{i||(i=!0,N(e,t,!0))}),c=()=>{clearTimeout(n),i&&(i=!1,N(e,t,!1))},u=x(document,"asor:before-send",a),m=x(document,"asor:after-request",c);return()=>{u(),m(),clearTimeout(n)}});var Me=new Set,Ne=new Set;function Oe(){(navigator.onLine?Ne:Me).forEach(r=>r())}window.addEventListener("online",Oe);window.addEventListener("offline",Oe);typeof navigator.onLine<"u"&&Oe();l("offline",({el:e,directive:t})=>{let r=()=>N(e,t,!0),o=()=>N(e,t,!1);return Me.add(r),Ne.add(o),typeof navigator.onLine<"u"&&N(e,t,!navigator.onLine),()=>{Me.delete(r),Ne.delete(o)}});var Cr=5e3;l("stream",({el:e,directive:t})=>{let r=t.expression,o=p(e,"swap")?.expression||"innerHTML",n=null,i=()=>{n=new EventSource(r),e._stream=n,n.onopen=()=>d(e,"stream:open"),n.onmessage=a=>Tr(e,a,o),n.onerror=a=>Ar(e,a,i)},s=()=>{n&&(n.close(),n=null)};return i(),()=>s()});function Tr(e,t,r){re(e,t.data,r),d(e,"stream:message",{data:t.data})}function Ar(e,t,r){d(e,"stream:error",{error:t}),r(),setTimeout(r,Cr)}l("id",async({el:e,directive:t})=>{let r=await y(e,t.expression?.trim());if(!Array.isArray(r)){console.error("a-id directive requires an array expression.");return}e._asor_ids||(e._asor_ids={}),r.forEach(o=>{e._asor_ids[o]||(e._asor_ids[o]=H(o))})});var Mr={on:Fe,stop:me,warn:w,error:f,store:Je,start:et,mount:J,debounce:ee,throttle:te,evaluate:y,directive:l,component:Ye,updateDOM:oe,onDataChange:b,dispatchSelf:qe,getDirectives:F,dispatchGlobal:Pe},$e=Mr;window.Asor=$e;queueMicrotask(()=>$e.start());})();
