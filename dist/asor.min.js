(()=>{var E=e=>e!==null&&typeof e=="object"&&!Array.isArray(e),x=e=>typeof e=="function",W=e=>Array.isArray(e),A=e=>typeof e=="string",Ne=e=>typeof e=="number";var O=e=>e===void 0;function w(e,t={},...r){Oe("Warning",e,t,...r)}function f(e,t={}){let r=typeof e=="string"?e:e.message||"Unknown error",n={message:r,...t};setTimeout(()=>Oe("Error",r,n),0)}function ie(e,t={},...r){let{el:n,expression:o,message:i="",defaultValue:s=null,rethrow:a=!1,onError:c}=t;try{return e(...r)}catch(u){let m=`${i}
${u.message}`;if(f(m,{el:n,expression:o}),c&&x(c)&&c(u,{el:n,expression:o,message:i}),a)throw u;return s}}function Oe(e,t,r={},...n){let{el:o,expression:i,component:s}=r,a=new Date().toISOString(),c={message:t,el:o,expression:i,component:s,timestamp:a,additionalInfo:n},u=e.toLowerCase()==="error"?"#FF0000":"#FFA500";console.groupCollapsed(`%c[Asor ${e}]: ${t}`,`color: ${u}; font-weight: bold;`),console.log(c),console.groupCollapsed("Stack Trace"),console.trace(),console.groupEnd()}var P=new Map,y=(e,t,r,n={})=>{let o=P.get(t);o||(o=new Set,P.set(t,o)),o.add(r);let i=new AbortController;return e.addEventListener(t,r,{...n,signal:i.signal}),()=>{i.abort(),o.delete(r),o.size===0&&P.delete(t)}},d=(e,t,r,n={})=>{let o=new CustomEvent(t,{bubbles:!0,cancelable:!0,...n,detail:r});return o.__asor={name:t,detail:r,receivedBy:[]},e.dispatchEvent(o)},Ie=(e,t)=>y(window,e,r=>r.__asor&&t(r)),$e=(e,t)=>d(window,e,t),Le=(e,t,r)=>d(e,t,r,{bubbles:!1}),Fe=()=>{P.forEach(e=>e.clear()),P.clear()};var I=new WeakMap,se=new Set,z=!1;function b(e,t){return I.has(e)||I.set(e,[]),I.get(e).push(t),()=>{let r=I.get(e);if(r){let n=r.indexOf(t);n>-1&&r.splice(n,1),r.length===0&&I.delete(e)}}}function $(e){se.add(e),bt()}function bt(){z||(z=!0,queueMicrotask(()=>Et()),z=!1)}function Et(){se.forEach(e=>{D(e);let t=I.get(e);t&&t.forEach(r=>r())}),se.clear(),z=!1}var Pe=new WeakMap;function _(e,t){Pe.set(e,t),e.__asor_def=t}function h(e){for(;e;){if(e.__asor_def)return e.__asor_def;e=e.parentElement}return{}}var K=e=>{Pe.delete(e),delete e.__asor_def};function D(e,t){let r=h(e);r&&(Object.assign(r,t),$(e))}var L=(e,t)=>{for(;e&&e!==document.body;){if(t(e))return e;e=e.parentElement}return null},qe=e=>document.querySelector(`meta[name='${e}']`)?.getAttribute("content")||"";var He=e=>L(e,t=>t.hasAttribute("a-def"))||document.body,B=e=>L(e,t=>t.dataset&&Object.keys(t.dataset).length>0||t.hasAttribute("a-def"))||document.body;var ae=e=>e.tagName==="FORM";var Re=(e,t)=>window.getComputedStyle(e).getPropertyValue(t);var q=(e="asor-",t=8)=>`${e}${Date.now()}-${Math.random().toString(36).slice(2,2+t)}`;function C(e=document.body,t=["a-","@",":"]){let r=[],n=document.createNodeIterator(e,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>Array.from(i.attributes).some(s=>t.some(a=>s.name.startsWith(a)))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}),o;for(;o=n.nextNode();)r.push(o);return r}var Ue=new WeakMap,ke=new Map,ce=new Map;function Dt(e){let t=e.join("|");return ce.has(t)||ce.set(t,new RegExp(`^(?:${t})([^\\s.:]+)(?:\\.[^\\s.:]+)*(?::[^\\s]+)?\\s*`)),ce.get(t)}var _t=e=>{if(!e)throw new Error("Directive name is required");return e.startsWith(":")?`a-bind:${e.slice(1)}`:e.startsWith("@")?`a-on:${e.slice(1)}`:e.startsWith("a-")?e:`a-${e}`},l=(e,t)=>ke.set(e,t),J=(e=document.body)=>C(e).forEach(Y);function Y(e){if(!e)return f(`Undefined element: ${e}`);let t=X(e);t.directives.sort((r,n)=>Ve.get(r.name)-Ve.get(n.name)).forEach(r=>{let n=ke.get(r.name);n&&n({el:e,directive:r,manager:t})})}var je=e=>Array.from(e.attributes).some(t=>t.name.startsWith(":")||t.name.startsWith("@")||t.name.startsWith("a-")),X=e=>{let t=Ue.get(e);if(!t){let r=Tt(e);t={el:e,directives:r,hasDirective:n=>r.some(o=>o.name===n),getDirective:n=>r.find(o=>o.name===n),delDirective:n=>t.directives=t.directives.filter(o=>o.name!==n)},Ue.set(e,t)}return t},St=["ref","def","id","bind","init","confirm","xhr","on","effect","show","navigate","transition","for","if","loading","offline","stream"],Ve=new Map(St.map((e,t)=>[e,t])),p=(e,t)=>{let r=X(e).getDirective(t);return r?{...r,name:t}:null},Tt=e=>{if(!e?.attributes)return f("Invalid element in extractDirectives"),[];let t=Dt(["a-","@",":"]);return Array.from(e.attributes).filter(r=>t.test(r.name)).map(({name:r,value:n})=>At(e,r,n))},At=(e,t,r)=>{let n=_t(t),{directiveName:o,directiveValue:i}=Ct(n),s=Mt(t);return{el:e,name:o,fullName:n,expression:r,value:i,modifiers:s,hasModifier:a=>s.has(a),getModifierValue:a=>s.get(a),getAllModifiers:()=>Array.from(s,([a,c])=>({name:a,value:c})),hasModifiers:()=>s.size>0,firstModifier:()=>{let[a,c]=s.entries().next().value||[];return a?{name:a,value:c}:null}}},Ct=e=>{let t=/^a-(?:(on):)?([^:.]+)(?::([^.]+))?/,[,r,n,o]=e.match(t)||[];return{directiveName:r||n,directiveValue:r?n:o}},Mt=e=>{let t=e.match(/\.[^.\]]+(?=[^\]]*$)/g)||[];return new Map(t.map(r=>{let[n,o]=r.slice(1).split("-");return[n,o===void 0?!0:o]}))};async function We(e,t){let r=C(e),n=C(t);r.forEach(o=>{let i=n.find(s=>s.isEqualNode(o));if(!i||!Nt(o,i))Y(o);else{let s=h(i);s&&_(o,s)}})}function Nt(e,t){let r=X(e),n=X(t);return r.directives.length!==n.directives.length?!1:r.directives.every((o,i)=>{let s=n.directives[i];return o.name===s.name&&o.expression===s.expression})}var G=!1;function ze(e=!1){if(G&&!e){w("Asor is already initialized. Skipping re-initialization.");return}fe();let t=()=>{d(document,"asor:init"),d(document,"asor:initializing"),requestAnimationFrame(()=>{J(),G=!0,d(document,"asor:initialized")})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t()}function fe(e=null){G&&(Fe(),window.asor&&delete window.asor,e&&x(e)&&e(),d(document,"asor:stopped"),G=!1)}var M={};function Ot(e={}){return M=new Proxy(e,{get(t,r){return typeof t[r]=="object"&&t[r]!==null?new Proxy(t[r],this):t[r]},set(t,r,n){return t[r]=n,Ke(),!0}}),M}function Ke(){document.querySelectorAll("[a-def]").forEach(e=>{try{e&&e.__asor_def&&(e.__asor_def.$store={...M},D(e))}catch(t){f("Error updating element after store change:",t,e)}})}var H=()=>M;function It(e,t){typeof t=="object"&&t!==null?M[e]={...M[e],...t}:M[e]=t,Ke()}var Be=(e,t)=>t===void 0?H()[e]:It(e,t);Ot();var ue={parseInt,parseFloat,isNaN,isFinite,encodeURIComponent,decodeURIComponent,encodeURI,decodeURI};function Q(e,t={}){let r=He(e),n=h(e)||h(r)||{},o=r._asor_refs||{},i={$el:e,$event:t.$event||{},$refs:o,$root:{...r,dataset:r?{...r.dataset}:{}},$dispatch:(s,a)=>d(e,s,a),$persist:s=>({__isPersist:!0,initialValue:s}),$store:H(),$id:s=>{let a=e._asor_ids||(e._asor_ids={});return a[s]||(a[s]=q(s))}};return{...i,$data:new Proxy(n,{get(s,a){if(a in s)return s[a];if(a in i)return i[a];if(a in t)return t[a];if(a in ue)return ue[a]}}),...ue,...t}}var R=new Map,$t=500,Lt=(e,t)=>({el:e,expression:t,rethrow:!1,defaultValue:null,message:`Error evaluating expression: "${t}"`}),Ft=e=>`
    with (__context) {
        with ($data) {
            return (${e});
        }
    }
`,Pt=e=>`
    try {
        ${e}
    } catch (e) {
        if (e instanceof ReferenceError) return undefined;
        throw e;
    }
`,qt=e=>{let t=Ft(e),r=Pt(t);return new Function("__context",r)},Ht=(e,t)=>{let r=Object.keys(t).sort().join(",");return`${e}::${r}`},Rt=(e,t)=>{if(R.size>=$t){let r=R.keys().next().value;R.delete(r)}R.set(e,t)};function le(e,t,r){let n=Lt(e,t);if(x(t))return ie(t,n,r);if(!A(t))return f(`Invalid expression type: ${typeof t}. Expected string or function.`,e,t),null;let o=Q(e,r),i=Ht(t,o),s=R.get(i);return s||(s=qt(t),Rt(i,s)),ie(()=>s(o),n)}var g=(e,t,r={})=>le(e,t,r);var de=new Map;function Xe(e,t){if(typeof t!="function"){f(`Component "${e}" must be a function.`);return}de.set(e,t)}function Ut(e){return de.get(e)}function Je(e){return de.has(e)}var Ye=(e,t)=>{let r=Ut(e);try{let n=Q(t,{});return r(n)}catch(n){return f(`Error executing component: ${n.message}`,{el:t,expression:e}),null}};l("ref",({el:e,directive:t})=>{let r=t.expression;if(!r)return;let n=B(e);if(n._asor_refs||(n._asor_refs={}),n._asor_refs[r]=e,n!==document.documentElement){let o=h(n)||{};o.$refs=n._asor_refs,_(n,o)}return()=>Vt(rootData)});function Vt(e){let t=getDirectiveValue(e,"ref")?.expression;if(t&&(delete e._asor_refs[t],e!==document.documentElement)){let r=h(e)||{};r.$refs&&(delete r.$refs[t],_(e,r))}}var Ge="asor_persist_";function Qe(e,t){let r=e.uniqueId||Ge+e,n=localStorage.getItem(r);if(n===null)return t;try{return JSON.parse(n)}catch(o){return w(`Error parsing stored value for key ${e}:`,o),t}}function pe(e,t){let r=e.uniqueId||Ge+e;try{localStorage.setItem(r,JSON.stringify(t))}catch(n){f(`Error storing value for key ${e}:`,n)}}var me=new WeakMap;function he(e,t){if((!e||!E(e))&&(e={}),me.has(e))return me.get(e);let r=zt(e,t),n=new Proxy(r,kt(t));return me.set(e,n),n}function kt(e){return{get(t,r,n){let o=Reflect.get(t,r,n);return o&&o.__isPersist?o.value:x(o)&&!r.startsWith("__")?jt(o,e,n):o},set(t,r,n,o){if(Wt(t,r,n,e))return!0;let i=t[r];return Reflect.set(t,r,n,o),i!==n&&$(e),!0}}}function jt(e,t,r){return function(...n){let o=e.apply(r,n);return $(t),o}}function Wt(e,t,r,n){if(e[t]&&e[t].__isPersist){let o=e[t].value;return e[t].value=r,pe(t,r),o!==r&&$(n),!0}return!1}function zt(e,t){let r={};return Kt(e,r),Bt(e,r,t),r}function Kt(e,t){Object.keys(e).forEach(r=>{let n=Object.getOwnPropertyDescriptor(e,r);n&&typeof n.get=="function"&&Object.defineProperty(t,r,{get:n.get.bind(t),enumerable:!0,configurable:!0})})}function Bt(e,t,r){Object.entries(e).forEach(([n,o])=>{o&&o.__isPersist?t[n]=Xt(n,o):E(o)?t[n]=he(o,r):x(o)?t[n]=o:t[n]||(t[n]=o)})}function Xt(e,t){let r=Qe(e,t.initialValue);return r==null&&(r=t.initialValue),pe(e,r),{__isPersist:!0,value:r}}var Ze=(e,t)=>{if(E(e))return e;if(!A(e)||!e.trim())return{};try{let r=le(t,`(${e})`,{});if(E(r))return r;f(`Invalid data attribute: ${e}`,t,e)}catch(r){return f(`Error parsing data attribute: ${r.message}`,t,e),{}}};function et(e){let t=e.match(/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/);if(!t)return null;let[,r,n]=t,o=r.replace(/^\(|\)$/g,"").split(",").map(i=>i.trim());return o.length===1?{item:o[0],items:n.trim()}:o.length===2?{item:o[0],key:o[1],items:n.trim()}:o.length===3?{item:o[0],key:o[1],index:o[2],items:n.trim()}:null}l("def",({el:e,directive:t})=>{try{let r=t.expression;r=r===""?"{}":r;let n=Je(r)?Ye(r,e):Ze(r,e);if(!n){f(`Failed to obtain data for a-def directive with expression: ${r}`,{el:e});return}let o=he(n,e);o.$store=H(),_(e,o),D(e);let i=b(e,()=>D(e));return()=>{i(),K(e),e.removeAttribute("a-def")}}catch(r){f("Error in a-def directive:",r,e)}});var Jt={text:e=>e.textContent,html:e=>e.innerHTML,value:e=>e.value,checked:e=>e.checked,selected:e=>e.selected,class:e=>e.className},Yt=new Map([["text",(e,t)=>e.textContent=t??""],["html",(e,t)=>e.innerHTML=t??""],["value",(e,t)=>{e.value!==t&&(e.value=t??"")}],["checked",(e,t)=>e.checked=!!t],["disabled",(e,t)=>e.disabled=!!t],["readonly",(e,t)=>e.readOnly=!!t],["required",(e,t)=>e.required=!!t],["multiple",(e,t)=>e.multiple=!!t],["hidden",(e,t)=>e.hidden=!!t],["radio",(e,t)=>e.checked=e.value==t],["open",(e,t)=>e.open=!!t],["class",Zt],["style",er],["selected",nr],["multipleSelect",or],["contenteditable",(e,t)=>{e.innerHTML!==t&&(e.innerHTML=t)}],["number",(e,t)=>{e.value=t==null?"":Number(t)}]]);function tt(e,t,r){if(!e)return;let n=Gt(e,t);Object.is(n,r)||Qt(e,t,r)}function Gt(e,t){return Jt[t]?.(e)??e.getAttribute(t)}function Qt(e,t,r){(Yt.get(t)||((n,o)=>n.setAttribute(t,o??"")))(e,r)}function Zt(e,t){if(A(t))e.className=t;else if(W(t))e.className=t.join(" ");else if(E(t))for(let[r,n]of Object.entries(t))r.includes(" ")?r.split(" ").forEach(o=>{e.classList.toggle(o.trim(),!!n)}):e.classList.toggle(r,!!n)}function er(e,t){A(t)?e.style.cssText=t:E(t)&&Object.assign(e.style,t)}function tr(e,t,r){let n=rr(e,r),o=e.closest("[a-def]");if(!o)return;h(o)&&D(o,{[t]:n})}function rr(e,t){return e.tagName==="SELECT"&&e.multiple?Array.from(e.selectedOptions).map(r=>r.value):e.type==="date"||e.type==="datetime-local"?e.valueAsDate:e.type==="checkbox"?t.target.checked:e.type==="file"?e.multiple?Array.from(e.files):e.files[0]:t.target.value}function nr(e,t){let r=Array.from(e.options);if(W(t))r.forEach(n=>n.selected=t.includes(n.value));else{let n=r.find(o=>o.value==t);n&&(n.selected=!0,e.value=n.value)}}function or(e,t){W(t)||(t=[t]),Array.from(e.options).forEach(r=>r.selected=t.includes(r.value))}function rt(e,t){if(["INPUT","TEXTAREA","SELECT"].includes(e.tagName)){let r=e.type==="checkbox"||e.type==="radio"||e.type==="file"?"change":"input";return y(e,r,n=>tr(e,t,n))}return null}l("bind",({el:e,directive:t})=>{let r=t.value||"text",n=t.expression;if(!n){f("La expresi\xF3n de binding est\xE1 vac\xEDa",null,e);return}let o=L(e,c=>c.__asor_def);if(!o){f("No se encontr\xF3 un propietario de datos para la directiva a-bind",e);return}let i=null,s=async()=>{try{let c=h(o),u=await g(e,n,{data:c});if(O(u))return;tt(e,r,u),i&&i(),i=rt(e,n)}catch(c){f("Error al actualizar el binding:",c,e)}};s();let a=b(o,()=>s());return()=>{a(),i&&i()}});l("init",({el:e,directive:t})=>{let r=t.expression?.trim();if(!r)return;let n=e.__asor_def||h(e);if(!n){f("No data found for a-init directive:",e);return}(async()=>await g(e,r,{data:n,$el:e}))()});l("effect",({el:e,directive:t})=>{let r=t.expression,n=async()=>{let s=e.__asor_def||h(e);if(!s)return;let a=await g(e,r,{data:s});if(x(a))return await a()},o,i=async()=>{o&&(o(),o=null);let s=await n();x(s)&&(o=s)};return i(),b(e,i)});l("confirm",({el:e,directive:t})=>{let r=t.expression,n=t.hasModifier("prompt");r=r.replaceAll("\\n",`
`),r===""&&(r="Are you sure?");let o=(i,s,a)=>{i?s():a()};e.__confirm_action=(i,s)=>{if(n){let[a,c]=r.split("|");c||f("Directives: You must provide an expectation with @confirm.prompt.");let u=prompt(a);o(u===c,i,s)}else o(confirm(r),i,s)}});function ot(e){let t=document.getElementById("asor-error");t||(t=document.createElement("div"),t.id="asor-error",t.style.cssText=`
            position: fixed;
            width: 100vw;
            height: 100vh;
            padding: 50px;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 200000;
        `,t.addEventListener("click",()=>nt(t)),t.tabIndex=0,document.body.prepend(t),document.body.style.overflow="hidden");let r=document.createElement("iframe");r.style.cssText=`
        background-color: #17161A;
        border-radius: 5px;
        width: 100%;
        height: 100%;
    `,t.innerHTML="",t.appendChild(r),r.contentWindow.document.open(),r.contentWindow.document.write(e),r.contentWindow.document.close(),t.addEventListener("keydown",n=>{n.key==="Escape"&&nt(t)}),t.focus()}function nt(e){e.outerHTML="",document.body.style.overflow="visible"}function xe(e){return new ge(e)}var ge=class{constructor(t){this.formData=new FormData,this.hasFile=!1,this.errors=[],t.tagName==="FORM"?this.serializeForm(t):this.collectElementData(t),this.addDirectiveData(t)}collectElementData(t){let r=this.elementHandlers[t.tagName];r&&r.call(this,t)}elementHandlers={SELECT:this.handleSelect,TEXTAREA:this.handleTextArea,INPUT:this.handleInput,BUTTON:this.handleButton};handleSelect(t){t.multiple?Array.from(t.selectedOptions).forEach(r=>{this.formData.append(t.name,r.value)}):this.formData.append(t.name,t.value)}handleTextArea(t){this.formData.append(t.name,t.value)}handleInput(t){let r={checkbox:()=>this.formData.append(t.name,t.checked),radio:()=>{t.checked&&this.formData.append(t.name,t.value)},file:()=>{t.files.length>0&&(Array.from(t.files).forEach(n=>{this.formData.append(t.name,n)}),this.hasFile=!0)},date:()=>{let n=new Date(t.value);isNaN(n.getTime())||this.formData.append(t.name,n.toISOString())},number:()=>{let n=parseFloat(t.value);isNaN(n)||this.formData.append(t.name,n)},default:()=>this.formData.append(t.name,t.value)};(r[t.type]||r.default)()}handleButton(t){t.name&&(t.type==="submit"||t.type==="button")&&this.formData.append(t.name,t.value||t.textContent)}addDirectiveData(t){let r=p(t,"data");r&&this.formData.append(r.value,r.expression);let n=p(t,"add");if(n)try{let o=JSON.parse(n.expression);Object.entries(o).forEach(([i,s])=>{this.formData.append(i,s)})}catch(o){f("Error parsing add directive:",o)}}serializeForm(t){this.formData=new FormData(t),this.hasFile=Array.from(this.formData.values()).some(r=>r instanceof File)}toObject(){let t={};for(let[r,n]of this.formData.entries())t[r]?(Array.isArray(t[r])||(t[r]=[t[r]]),t[r].push(n)):t[r]=n;return t}toJSON(){return JSON.stringify(this.toObject())}get(){return this.formData}hasFiles(){return this.hasFile}getErrors(){return this.errors}};function st(e){return p(e,"swap")?.expression||"innerHTML"}var it={innerHTML:(e,t)=>{e.innerHTML=t},outerHTML:(e,t)=>{e.outerHTML=t},beforebegin:(e,t)=>{e.insertAdjacentHTML("beforebegin",t)},afterbegin:(e,t)=>{e.insertAdjacentHTML("afterbegin",t)},beforeend:(e,t)=>{e.insertAdjacentHTML("beforeend",t)},afterend:(e,t)=>{e.insertAdjacentHTML("afterend",t)},replace:(e,t)=>{e.replaceWith(...ye(t))},append:(e,t)=>{e.append(...ye(t))},prepend:(e,t)=>{e.prepend(...ye(t))}};function Z(e,t,r){try{(it[r]||it.innerHTML)(e,t)}catch(n){f(`Error applying swap method "${r}":`,n)}}var ye=e=>{let t=document.createElement("div");return t.innerHTML=e,t.childNodes};var U=new WeakMap;function at(e){if(U.has(e))return U.get(e);let t=p(e,"target");if(t){let r=t.expression?.trim();if(r){let n=document.querySelector(r);if(n)return U.set(e,n),n;w(`Target element "${r}" not found. Using original element.`)}}return U.set(e,e),e}function ct(e){let t=p(e,"target");t?.modifiers.includes("once")&&(e.removeAttribute(t.directive),U.delete(e))}var ve=new Set,we=!1;async function ft(e,t){let n=new DOMParser().parseFromString(t,"text/html"),o=at(e),i=st(o),s=n.body.innerHTML,a=o.cloneNode(!0);ar(o,()=>{Z(o,s,i),ir(a,o),sr(o),ct(o)})}function ir(e,t){let r=C(e),n=C(t);n.forEach(o=>{let i=r.find(s=>s.isEqualNode(o));if(i){let s=h(i);s&&_(o,s)}}),We(t,e),r.forEach(o=>{n.some(i=>i.isEqualNode(o))||ut(o)})}function ut(e){let t=h(e);t&&t.$refs&&Object.keys(t.$refs).forEach(r=>{t.$refs[r]===e&&delete t.$refs[r]}),K(e),Array.from(e.children).forEach(ut)}function sr(e){p(e,"transition")&&d(e,"asor:transition",{visible:!0})}function ar(e,t){ve.add({el:e,updateFn:t}),cr()}function cr(){we||(we=!0,requestAnimationFrame(fr))}function fr(){for(let{el:e,updateFn:t}of ve)t(e);ve.clear(),we=!1}var be=new Map,lt=()=>new Ee,Ee=class{async handleRequest(t,r,n){let o=this.buildRequestOptions(r,t);d(document,"asor:before-request",{method:r,url:n,options:o});try{let i=await this.fetchData(r,n,o,t);if(!i)return;await this.handleResponse(i,t)}catch(i){this.handlerError(i,t)}finally{d(document,"asor:after-request",{method:r,url:n,options:o})}}buildRequestOptions(t,r){let n={method:t.toUpperCase(),headers:this.buildHeaders(r)};if(["POST","PUT","PATCH"].includes(n.method)){let o=xe(r);n.body=this.prepareRequestBody(r,o)}return n}buildHeaders(t){return{Accept:"text/html, application/xhtml+xml","X-Requested-With":"XMLHttpRequest","X-Current-URL":document.location.href,"X-Asor":"true","Content-Type":this.getContentType(t)}}getContentType(t){let r=xe(t);return ae(t)||r.hasFiles()?void 0:p(t,"enctype")?.expression||"application/json"}prepareRequestBody(t,r){return ae(t)||r.hasFiles()?r.get():JSON.stringify(r.toObject())}async fetchData(t,r,n,o){d(document,"asor:before-send",{method:t,url:r,options:n}),d(document,"asor:send",{method:t,url:r,options:n});let i=`${t}:${r}`;if(be.has(i))return be.get(i);let s=await fetch(r,n);if(!s.ok)return this.handlerError(`HTTP error! status: ${s.status}`,o),!1;let a=await s.text();return be.set(i,a),a}async handleResponse(t,r){d(document,"asor:before-render",{response:t});let n=this.getTargetDirective(r);await ft(n,t),d(document,"asor:render",{html:t})}getTargetDirective(t){let r=p(t,"target")?.expression;return r?document.querySelector(r):t}handlerError(t,r){f("XHR request failed:",r,t),ot(t.message)}};async function ee(e){return p(e,"confirm")?.expression?new Promise(r=>{x(e.__confirm_action)?e.__confirm_action(()=>r(!0),()=>r(!1)):r(!0)}):!0}function dt(e,t){let r;return function(...n){clearTimeout(r),r=setTimeout(()=>e(...n),t)}}function pt(e,t){let r;return function(...n){r||(e.apply(this,n),r=!0,setTimeout(()=>r=!1,t))}}var _e={enter:13,tab:9,delete:46,esc:27,space:32,up:38,down:40,left:37,right:39,shift:16,ctrl:17,alt:18,meta:91},Se=["shift","ctrl","alt","meta"],ur=["get","post","put","patch","delete"],V=new WeakMap,ht=e=>ur.includes(e.value?.toLowerCase())?e.value.toLowerCase():"get",De={form:"submit",select:"change",textarea:"input",button:"click",input:{button:"click",submit:"click",reset:"click",checkbox:"change",radio:"change",file:"change",date:"change",time:"change","datetime-local":"change"},default:"click"};function gt(e){let t=e.tagName.toLowerCase(),r=(e.type||"").toLowerCase();return t==="input"?De.input[r]||"input":De[t]||(e.isContentEditable?"input":e.getAttribute("tabindex")!==null?"focus":De.default)}var te=(e,t,r={})=>{let{preventDefault:n,stopPropagation:o,once:i,delay:s,throttleTime:a,passive:c,keyModifiers:u,self:m}={preventDefault:!1,stopPropagation:!1,once:!1,delay:0,throttleTime:0,passive:!1,keyModifiers:[],self:!1,...r},v=JSON.stringify({preventDefault:n,stopPropagation:o,once:i,delay:s,throttleTime:a,passive:c,keyModifiers:u,self:m});V.has(e)||V.set(e,new Map);let S=V.get(e);if(!S.has(v)){let F=async T=>{if(T.type==="intersect")return mt(()=>t(T),s,a);m&&T.target!==e||pr(T)&&!mr(T,u)||(n&&!c&&x(T.preventDefault)&&T.preventDefault(),o&&x(T.stopPropagation)&&T.stopPropagation(),mt(()=>dr(e,T,t),s,a),i&&lr(e,v))};S.set(v,F)}return S.get(v)},mt=(e,t,r)=>t>0?dt(e,t)():r>0?pt(e,r)():e(),lr=(e,t)=>{let r=V.get(e);r.delete(t),r.size===0&&V.delete(e)},dr=async(e,t,r)=>{try{if(!await ee(e))return;(x(r)?await r.call(e,t):!0)!==!1&&e.__xhr_handler&&!e.__xhr_request_in_progress&&await e.__xhr_handler.call(e,t)}catch(n){f("Error in event handler:",n,e)}},pr=e=>e.type?.startsWith("key"),mr=(e,t)=>t.every(r=>Se.includes(r)?e[`${r}Key`]:e.keyCode===_e[r]),hr=(e,t,r={})=>{let n=new IntersectionObserver(o=>{o.forEach(i=>{if(i.isIntersecting)try{t(i,e),r.once&&n.unobserve(e),r.disconnect&&n.disconnect()}catch(s){f("Error in IntersectionObserver callback:",s)}})},r);return n.observe(e),()=>n.disconnect()},xt=(e,t,r,n={})=>y(document,t,o=>{e.contains(o.target)||r(o)},n);var re=(e,t,r)=>{let{rootMargin:n="0px",threshold:o=.1,once:i}=r;return hr(e,(a,c)=>{let u={type:"intersect",detail:{entry:a,element:c},target:c};d(c,"intersect",u.detail)&&t.call(c,u)},{rootMargin:n,threshold:o,once:i,disconnect:i})};l("xhr",({el:e,directive:t,manager:r})=>{let n=t.expression,o=ht(t),i=gt(e),s=async()=>{if(!e.__xhr_request_in_progress){e.__xhr_request_in_progress=!0;try{await lt().handleRequest(e,o,n)}catch(c){f("XHR request failed:",c)}finally{e.__xhr_request_in_progress=!1}}},a=()=>{};if(r.hasDirective("on"))e.__xhr_handler=s;else{let c=te(e,s,{preventDefault:!0,stopPropagation:!0});a=y(e,i,c)}return()=>{a(),delete e.__xhr_handler,delete e.__xhr_request_in_progress}});function yt(e,t){if(!(e instanceof Map))return t;for(let[,r]of e){let n=E(r)?r.value:r;if(A(n)){let o=ne(n);if(o!==null)return o}}return t}function ne(e){let t=/^(\d+)(ms|s)$/;if(A(e)&&t.test(e)){let[,r,n]=e.match(t);return n==="ms"?Number(r):Number(r)*1e3}return null}l("on",({el:e,directive:t})=>{let{modifiers:r,expression:n,value:o}=t,i=o?o.split(",").map(a=>a.trim()):[];if(i.length===0){f("No event specified for a-on directive in element: ",e);return}let s={preventDefault:r?.has("prevent")||!1,stopPropagation:r?.has("stop")||!1,once:r?.has("once")||!1,capture:r?.has("capture")||!1,passive:r?.has("passive")||!1,self:r?.has("self")||!1,window:r?.has("window")||!1,document:r?.has("document")||!1,outside:r?.has("outside")||!1,rootMargin:r?.get("rootMargin")?.value,threshold:r?.get("threshold")?.value,delay:ne(r?.get("debounce")?.value||"0"),throttle:ne(r?.get("throttle")?.value||"0"),keyModifiers:Array.from(r?.keys()||[]).filter(a=>a in _e||Se.includes(a))};try{let c=te(e,async m=>await g(e,n,{$event:m,$el:e}),s),u=i.map(m=>m==="intersect"?re(e,c,s):gr(e,m,c,s));return()=>u.forEach(m=>m())}catch(a){f(`Error evaluating expression in a-on directive: ${a.message}`,e)}});function gr(e,t,r,n){return n.window?y(window,t,r,n):n.document?y(document,t,r,n):n.outside&&t==="click"?xt(e,t,r,n):y(e,t,r,n)}async function xr(e,t,r,n,o,i,s){let a=document.createElement("template");a.innerHTML=e.trim();let c=a.content.firstElementChild||a.content.firstChild;if(!c)return f("Invalid template in a-for directive",s),null;let u={...o,[i.item]:t,[i.key||"key"]:r,[i.index||"index"]:r,length:n,parent:o};_(c,u),D(c);let m=p(c,"if");if(m&&!await g(c,m.expression,u))return null;let v=p(c,"show");return v&&(c.style.display=await g(c,v.expression,u)?"":"none"),C(c).forEach(S=>{je(S)&&Y(S)}),c}async function vt(e,t,r,n,o){if(t==null){w("Items is null or undefined in appendItems");return}let i=Array.isArray(t),s=i?t:Object.entries(t),a=document.createDocumentFragment();e.parentElement.querySelectorAll('[data-asor-generated="true"]').forEach(u=>u.remove());for(let[u,m]of s.entries()){let v=i?u:m[0],S=i?m:m[1],F=await xr(n,S,v,s.length,r,o,e);F&&(F.setAttribute("data-asor-generated","true"),a.appendChild(F))}e.parentElement.insertBefore(a,e.nextSibling)}l("for",({el:e,directive:t})=>{let r=et(t.expression);if(!r){f("Invalid expression for a-for directive",e);return}let n=e.innerHTML;e.innerHTML="";let o=L(e,c=>c.__asor_def);if(!o){f("No data owner found for a-for directive",e);return}let i=!1,s=async()=>{let c=o.__asor_def,u=await g(e,r.items,c);if(Ne(u)&&(u=yr(u)),O(u)){w(`${r.items} is not defined`,e);return}await vt(e,u,c,n,r),i=!0};s();let a=b(o,()=>{i&&s()});return()=>a()});var yr=e=>{let t=e;return Array.from({length:t},(r,n)=>n+1)};l("if",({el:e,directive:t})=>{let{expression:r}=t,n=document.createComment(`if: ${r}`),o=!1,i=()=>{let s=g(e,r);s&&!o&&e.parentNode?(e.parentNode.insertBefore(n,e.nextSibling),o=!0):!s&&o&&e.parentNode&&(e.parentNode.replaceChild(n,e),o=!1)};return e.parentNode&&e.parentNode.insertBefore(n,e.nextSibling),()=>{i(),n.parentNode&&n.remove(),o&&e.parentNode&&e.remove()}});l("show",({el:e,directive:t})=>{let{expression:r,modifiers:n}=t,o=B(e);if(!o){console.error("No se encontr\xF3 un elemento ra\xEDz con a-def para la directiva a-show.");return}let i=async()=>{try{let a=await g(e,r);O(a)||vr(e,a,n.has("important"))}catch(a){console.error("Error updating visibility for element:",e,a)}};i();let s=b(o,()=>i());return()=>s()});function vr(e,t,r){p(e,"transition")?d(e,"asor:transition",{visible:t}):(e.style.display=t?"":"none",r&&e.style.setProperty("display",e.style.display,"important"))}var k=class e{static DEFAULT_OPTIONS={color:"#29d",height:"3px",duration:300,delay:300,zIndex:14062024,className:"asor-progress-bar"};constructor(t={}){this.options={...e.DEFAULT_OPTIONS,...t},this.bar=null,this.visible=!1,this.timeout=null,this.value=0,this.trickleInterval=null}show(){this.visible||(this.visible=!0,this.value=0,clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.createBar(),this.trickle()},this.options.delay))}hide(){this.visible&&(clearTimeout(this.timeout),clearInterval(this.trickleInterval),this.visible=!1,this.setValue(100),this.timeout=setTimeout(()=>{this.removeBar(),this.value=0},this.options.duration))}setValue(t){this.value=Math.min(100,Math.max(0,t)),this.bar&&(this.bar.style.width=`${this.value}%`,this.updateARIA())}trickle(){clearInterval(this.trickleInterval),this.trickleInterval=setInterval(()=>{let t=100-this.value,r=.02*Math.pow(1-Math.sqrt(t),2);this.setValue(this.value+r)},100)}createBar(){this.bar||(this.bar=document.createElement("div"),this.bar.className=this.options.className,this.bar.style.cssText=`
            position: fixed;
            top: 0;
            left: 0;
            width: 0;
            height: ${this.options.height};
            background-color: ${this.options.color};
            z-index: ${this.options.zIndex};
            transition: width ${this.options.duration}ms ease-out;
            box-shadow: 0 0 10px ${this.options.color}, 0 0 5px ${this.options.color};
            pointer-events: none;
        `,this.setAccessibility(),document.body.appendChild(this.bar))}removeBar(){this.bar&&this.bar.parentNode&&(this.bar.parentNode.removeChild(this.bar),this.bar=null)}setAccessibility(){this.bar&&(this.bar.setAttribute("role","progressbar"),this.bar.setAttribute("aria-valuemin","0"),this.bar.setAttribute("aria-valuemax","100"),this.updateARIA())}updateARIA(){this.bar&&(this.bar.setAttribute("aria-valuenow",Math.round(this.value)),this.bar.setAttribute("aria-label",`Progress: ${Math.round(this.value)}%`))}static injectStyles(){let t=document.createElement("style");t.textContent=`
            @keyframes asor-progress-bar-pulse {
                0% { box-shadow: 0 0 10px ${e.DEFAULT_OPTIONS.color}, 0 0 5px ${e.DEFAULT_OPTIONS.color}; }
                50% { box-shadow: 0 0 20px ${e.DEFAULT_OPTIONS.color}, 0 0 10px ${e.DEFAULT_OPTIONS.color}; }
                100% { box-shadow: 0 0 10px ${e.DEFAULT_OPTIONS.color}, 0 0 5px ${e.DEFAULT_OPTIONS.color}; }
            }
            .${e.DEFAULT_OPTIONS.className} {
                animation: asor-progress-bar-pulse 1.5s infinite ease-in-out;
            }
        `;let r=qe("csp-nonce");r&&(t.nonce=r),document.head.appendChild(t)}};k.injectStyles();var wt=50,oe=class{constructor(){this.progressBar=new k({delay:250}),this.cache=new Map,this.scrollPositions=new Map,this.currentRequest=null,this.executedScripts=new Set,window.addEventListener("popstate",this.handlePopState.bind(this))}handleNavigate=async t=>{if(this.shouldInterceptClick(t))return;t.preventDefault();let r=t.currentTarget.href||t.currentTarget.getAttribute("href");if(!r){f("No URL found for navigation.");return}await this.navigate(r)};shouldInterceptClick=t=>t.which>1||t.altKey||t.ctrlKey||t.metaKey||t.shiftKey;handlePopState=async()=>{let t=window.location.href,r=new URL(t,document.baseURI).href;if(this.cache.has(r)){let n=this.cache.get(r);await this.renderView(n.html)}else await this.navigate(t,{pushState:!1})};async navigate(t,r={pushState:!0}){try{this.clearExecutedScripts(),this.progressBar.show(),this.saveScrollPosition(),d(document,"asor:navigating",{url:t});let n=await this.loadView(t);if(!n)return;let o=new URL(t,document.baseURI);r.pushState?await this.updateState("pushState",o.href):await this.updateState("replaceState",o.href),await this.renderView(n.html),this.restoreScrollPosition(t),this.animateTransition(),d(document,"asor:navigated",{url:o.href})}catch(n){f("Navigation error:",n)}finally{this.progressBar.hide()}}async loadView(t){let r=new URL(t,document.baseURI).href,n=r;if(this.cache.has(n))return this.cache.get(n);this.currentRequest&&this.currentRequest.abort();let o=new AbortController;this.currentRequest=o;try{let i=await fetch(r,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"},signal:o.signal});i.ok||f(`Navigation to ${t} failed with state ${i.status}`);let a={html:await i.text()};return this.cache.set(n,a),this.trimCache(),a}catch(i){throw i.name==="AbortError"?w(`Solicitud a ${t} abortada`):f(`Error while navigating to ${t}:`,i),i}finally{this.currentRequest===o&&(this.currentRequest=null)}}trimCache(){this.cache.size>wt&&Array.from(this.cache.keys()).slice(0,this.cache.size-wt).forEach(r=>this.cache.delete(r))}saveScrollPosition(){let r=new URL(window.location.href).href;this.scrollPositions.set(r,{x:window.scrollX,y:window.scrollY})}restoreScrollPosition(t){let n=new URL(t).href;requestAnimationFrame(()=>{let o=this.scrollPositions.get(n)||{x:0,y:0};window.scrollTo(o.x,o.y)})}animateTransition(){document.body.style.opacity="0",requestAnimationFrame(()=>{document.body.style.transition="opacity 0.3s",document.body.style.opacity="1",setTimeout(()=>{document.body.style.transition=""},300)})}async updateState(t,r){try{history[t]({},document.title,r)}catch(n){n instanceof DOMException&&n.name==="SecurityError"&&f(`You cannot use asor:navigate with a link to a different root domain: ${r}`)}}async renderView(t){let n=new DOMParser().parseFromString(t,"text/html");document.title=n.title,await this.updateHead(n.head),await this.updateBody(n.body),this.executeScripts(document.head),this.executeScripts(document.body),window.Asor&&x(window.Asor.start)&&window.Asor.start(!0)}async updateHead(t){let r=document.head;Array.from(r.children).forEach(n=>{n.hasAttribute("data-persist")||n.remove()}),Array.from(t.children).forEach(n=>{n.hasAttribute("data-persist")||r.appendChild(n.cloneNode(!0))})}async updateBody(t){document.body.innerHTML=t.innerHTML}executeScripts(t){t.querySelectorAll("script").forEach(r=>{let n=document.createElement("script");Array.from(r.attributes).forEach(o=>n.setAttribute(o.name,o.value)),r.src?this.executedScripts.has(r.src)||(n.src=r.src,this.executedScripts.add(r.src)):(n.textContent=r.textContent,this.executedScripts.add(r.textContent)),r.parentNode.replaceChild(n,r)})}clearExecutedScripts(){this.executedScripts.clear()}async preloadView(t){let r=new URL(t,document.baseURI).href,n=r;if(!this.cache.has(n))try{let o=await fetch(r,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"},signal:AbortSignal.timeout(1e4)});o.ok||f(`Precarga de ${t} fall\xF3 con el estado ${o.status}`);let i=await o.text();this.cache.set(n,{html:i}),this.trimCache()}catch(o){f("Error en la precarga:",o)}}};var j;l("navigate",({el:e,directive:t})=>{if(j||(j=new oe),e.hasNavigateListener)return;e.hasNavigateListener=!0;let r=!1;y(e,"click",async o=>{if(!r){r=!0,o.type==="click"&&o.preventDefault();try{await ee(e)&&await j.handleNavigate(o)}catch(i){f("Navigation error:",i)}finally{r=!1}}}),t.hasModifier("lazy")?wr(e,t):t.hasModifier("hover")&&br(e)});function wr(e,t){return re(e,()=>{let n=e.getAttribute("href");n&&j.preloadView(n)},{rootMargin:t.getModifierValue("margin")||"90px",once:t.hasModifier("once")})}function br(e){y(e,"mouseenter",()=>{let r=e.getAttribute("href");r&&j.preloadView(r)})}l("transition",({el:e,directive:t})=>{let r=_r(t),n=!1,o=null,i=c=>{if(n||c===o)return;n=!0,o=c;let u=c?"enter":"leave",m=c?r.enterDuration:r.leaveDuration;r.useClasses?Er(e,u,m):Dr(e,c,r),setTimeout(()=>{n=!1,c||(e.style.display="none")},m)},a=y(e,"asor:transition",c=>{let u=c.detail.visible;u!==o&&(u&&(e.style.display=""),i(u))});return o=window.getComputedStyle(e).display!=="none",o||(e.style.display="none"),a});function Er(e,t,r){let n=p(e,`transition:${t}`)?.expression,o=p(e,`transition:${t}-start`)?.expression,i=p(e,`transition:${t}-end`)?.expression;n&&e.classList.add(n),o&&(e.classList.add(o),requestAnimationFrame(()=>{requestAnimationFrame(()=>{e.classList.remove(o),i&&e.classList.add(i)})})),setTimeout(()=>{n&&e.classList.remove(n),i&&e.classList.remove(i)},r)}function Dr(e,t,r){e.style.transition="none",e.offsetWidth,e.style.opacity=t?r.initialOpacity:"1",r.scale&&(e.style.transform=`scale(${t?r.initialScale:"1"})`),e.offsetWidth,e.style.transition=`all ${t?r.enterDuration:r.leaveDuration}ms ${r.easing}`,e.style.opacity=t?"1":r.initialOpacity,r.scale&&(e.style.transform=`scale(${t?"1":r.initialScale})`),r.origin!=="center"&&(e.style.transformOrigin=r.origin)}function _r(e){let t={enterDuration:300,leaveDuration:300,delay:0,easing:"ease",opacity:!0,scale:!1,initialOpacity:"0",initialScale:"0.95",useClasses:!1,origin:"center"},r=new Map([["duration","enterDuration"],["enter","enterDuration"],["leave","leaveDuration"],["delay","delay"]]);return e.modifiers.forEach((n,o)=>{r.has(o)?(t[r.get(o)]=yt(new Map([[o,n]]),t[r.get(o)]),o==="duration"&&(t.leaveDuration=t.enterDuration)):["ease","ease-in","ease-out","ease-in-out","linear"].includes(o)?t.easing=o:o==="opacity"?(t.opacity=!0,t.scale=!1):o==="scale"?(t.scale=!0,t.opacity=n!=="false",n&&n!=="true"&&(t.initialScale=parseFloat(n)/100)):o==="origin"&&(t.origin=n||"center")}),(p(e.el,"transition:enter")||p(e.el,"transition:leave"))&&(t.useClasses=!0),t}function N(e,t,r,n=null){if(r=t.hasModifier("remove")?!r:r,t.hasModifier("class")){let o=t.expression.split(" ").filter(String);r?e.classList.add(...o):e.classList.remove(...o)}else if(t.hasModifier("attr"))r?e.setAttribute(t.expression,!0):e.removeAttribute(t.expression);else{let o=n??Re(e,"display"),i=["inline","block","table","flex","grid","inline-flex"].find(s=>t.hasModifier(s))||"inline-block";i=t.hasModifier("remove")&&!r?o:i,e.style.display=r?i:"none"}}l("loading",({el:e,directive:t})=>{let r={shortest:50,shorter:100,short:150,default:200,long:300,longer:500,longest:1e3},n=t.getAllModifiers().reduce((v,S)=>r[S.name]||v,r.default),o,i=!1,a=(v=>t.hasModifier("delay")&&!t.hasModifier("none")?()=>{o=setTimeout(()=>{v()},n)}:v)(()=>{i||(i=!0,N(e,t,!0))}),c=()=>{clearTimeout(o),i&&(i=!1,N(e,t,!1))},u=y(document,"asor:before-send",a),m=y(document,"asor:after-request",c);return()=>{u(),m(),clearTimeout(o)}});var Te=new Set,Ae=new Set;function Ce(){(navigator.onLine?Ae:Te).forEach(r=>r())}window.addEventListener("online",Ce);window.addEventListener("offline",Ce);typeof navigator.onLine<"u"&&Ce();l("offline",({el:e,directive:t})=>{let r=()=>N(e,t,!0),n=()=>N(e,t,!1);return Te.add(r),Ae.add(n),typeof navigator.onLine<"u"&&N(e,t,!navigator.onLine),()=>{Te.delete(r),Ae.delete(n)}});var Sr=5e3;l("stream",({el:e,directive:t})=>{let r=t.expression,n=p(e,"swap")?.expression||"innerHTML",o=null,i=()=>{o=new EventSource(r),e._stream=o,o.onopen=()=>d(e,"stream:open"),o.onmessage=a=>Tr(e,a,n),o.onerror=a=>Ar(e,a,i)},s=()=>{o&&(o.close(),o=null)};return i(),()=>s()});function Tr(e,t,r){Z(e,t.data,r),d(e,"stream:message",{data:t.data})}function Ar(e,t,r){d(e,"stream:error",{error:t}),r(),setTimeout(r,Sr)}l("id",async({el:e,directive:t})=>{let r=await g(e,t.expression?.trim());if(!Array.isArray(r)){console.error("a-id directive requires an array expression.");return}e._asor_ids||(e._asor_ids={}),r.forEach(n=>{e._asor_ids[n]||(e._asor_ids[n]=q(n))})});var Cr={on:Ie,stop:fe,warn:w,error:f,store:Be,start:ze,mount:J,evaluate:g,directive:l,component:Xe,onDataChange:b,dispatchSelf:Le,dispatchGlobal:$e},Me=Cr;window.Asor=Me;queueMicrotask(()=>Me.start());})();
